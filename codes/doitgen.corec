/* Multiresolution ADaptive NumErical Scientific Simulation (MADNESS) */
prog doitgen {

  def Inita { [in: NR,NQ,NP; out: (a,NR,NQ,NP)]
    Dom: i in [0..NR-1], j in [0..NQ-1], k in [0..NP-1]
    Rec: a[i,j,k]=((i*j + k) % NP) / NP
  }
  
  def Initc4 { [in: NP; out: (c4,NP,NP)]
    Dom: i in [0..NP-1], j in [0..NP-1]
    Rec: c4[i,j]=(i*j % NP) / NP
  }  
  
  def Eq1 { [in: (sum,NP), r,q,NR,NQ,NP; inout: (a,NR,NQ,NP)]
    Dom: k in [0..NP-1]
    Rec: a[r,q,k] = sum[k]
  }      

  def Eq2 { [in: (c4,NP,NP), NR,NQ,NP; inout: (a,NR,NQ,NP)]
    Loc: r,q, /* déclaration de variables locales entières */
         (sum,NP) /* déclaration de tableau local */
    Dom: i in [0..NR-1], j in [0..NQ-1], k in [0..NP-1], l in [0..NP-1]
    Rec: { 
      l==0?sum[k]=0: ;
      sum[k] += a[i,j,l] * c4[l,k];
      k==NP-1?l==NP-1?
      {
        r=i;
        q=j;
        Eq1() /* appel de fonction dans une fonction */
      }::
    }
  }
  
  def Main {
      Loc: NR,NQ,NP
      Dom:
      Rec: {
        printstr("Entrez une valeur entière NR : ");
        read(NR);
        printstr("Entrez une valeur entière NQ : ");
        read(NQ);
        printstr("Entrez une valeur entière NP : ");
        read(NP); 
        printstr("Le résultat est : ");
        print(Eq2(Initc4(),Inita()))
      }
  }
}

/* Résultat attendu pour NQ=8, NR=10 et NP=12 :
0.00 3.51 2.78 2.38 2.06 2.74 1.50 2.76 1.94 2.12 2.22 1.99 0.00 3.51 2.78 2.38 2.06 2.74 1.50 2.76 
1.94 2.12 2.22 1.99 0.00 3.51 2.78 2.38 2.06 2.74 1.50 2.76 1.94 2.12 2.22 1.99 0.00 3.51 2.78 2.38 
2.06 2.74 1.50 2.76 1.94 2.12 2.22 1.99 0.00 3.51 2.78 2.38 2.06 2.74 1.50 2.76 1.94 2.12 2.22 1.99 
0.00 3.51 2.78 2.38 2.06 2.74 1.50 2.76 1.94 2.12 2.22 1.99 0.00 3.51 2.78 2.38 2.06 2.74 1.50 2.76 
1.94 2.12 2.22 1.99 0.00 3.51 2.78 2.38 2.06 2.74 1.50 2.76 1.94 2.12 2.22 1.99 0.00 3.51 2.78 2.38 
2.06 2.74 1.50 2.76 1.94 2.12 2.22 1.99 0.00 3.06 2.36 2.00 1.72 2.61 1.25 2.81 1.94 2.25 2.47 2.36 
0.00 2.68 2.11 1.88 1.72 2.90 1.50 2.43 1.61 2.12 2.56 2.65 0.00 2.39 2.03 2.00 2.06 2.61 1.25 2.64 
1.94 1.75 2.47 2.86 0.00 2.18 2.11 2.38 1.72 2.74 1.50 2.43 1.94 2.13 2.22 2.99 0.00 2.06 2.36 2.00 
1.72 2.28 1.25 2.81 1.61 2.25 1.81 3.03 0.00 2.01 2.78 1.88 2.06 2.24 1.50 2.76 1.94 2.12 2.22 2.99 
0.00 2.06 2.36 2.00 1.72 2.61 1.25 2.31 1.94 1.75 2.47 2.86 0.00 3.51 2.78 2.38 2.06 2.74 1.50 2.76 
1.94 2.12 2.22 1.99 0.00 2.68 2.11 1.88 1.72 2.90 1.50 2.43 1.61 2.12 2.56 2.65 0.00 2.18 2.11 2.38 
1.72 2.74 1.50 2.43 1.94 2.13 2.22 2.99 0.00 2.01 2.78 1.88 2.06 2.24 1.50 2.76 1.94 2.12 2.22 2.99 
0.00 2.18 2.11 2.38 1.72 2.40 1.50 2.43 1.61 2.12 2.56 2.65 0.00 2.68 2.11 1.88 1.72 2.24 1.50 2.43 
1.94 2.12 2.22 1.99 0.00 3.51 2.78 2.38 2.06 2.74 1.50 2.76 1.94 2.12 2.22 1.99 0.00 2.68 2.11 1.88 
1.72 2.90 1.50 2.43 1.61 2.12 2.56 2.65 0.00 3.51 2.78 2.38 2.06 2.74 1.50 2.76 1.94 2.12 2.22 1.99 
0.00 2.39 2.03 2.00 2.06 2.61 1.25 2.64 1.94 1.75 2.47 2.86 0.00 2.01 2.78 1.88 2.06 2.24 1.50 2.76 
1.94 2.12 2.22 2.99 0.00 2.39 2.03 2.00 2.06 2.61 1.25 2.14 1.94 2.25 2.47 2.36 0.00 3.51 2.78 2.38 
2.06 2.74 1.50 2.76 1.94 2.12 2.22 1.99 0.00 2.39 2.03 2.00 2.06 2.61 1.25 2.64 1.94 1.75 2.47 2.86 
0.00 2.01 2.78 1.88 2.06 2.24 1.50 2.76 1.94 2.12 2.22 2.99 0.00 2.39 2.03 2.00 2.06 2.61 1.25 2.14 
1.94 2.25 2.47 2.36 0.00 3.51 2.78 2.38 2.06 2.74 1.50 2.76 1.94 2.12 2.22 1.99 0.00 2.18 2.11 2.38 
1.72 2.74 1.50 2.43 1.94 2.13 2.22 2.99 0.00 2.18 2.11 2.38 1.72 2.40 1.50 2.43 1.61 2.12 2.56 2.65 
0.00 3.51 2.78 2.38 2.06 2.74 1.50 2.76 1.94 2.12 2.22 1.99 0.00 2.18 2.11 2.38 1.72 2.74 1.50 2.43 
1.94 2.13 2.22 2.99 0.00 2.18 2.11 2.38 1.72 2.40 1.50 2.43 1.61 2.12 2.56 2.65 0.00 3.51 2.78 2.38 
2.06 2.74 1.50 2.76 1.94 2.12 2.22 1.99 0.00 2.18 2.11 2.38 1.72 2.74 1.50 2.43 1.94 2.13 2.22 2.99 
0.00 3.51 2.78 2.38 2.06 2.74 1.50 2.76 1.94 2.12 2.22 1.99 0.00 2.06 2.36 2.00 1.72 2.28 1.25 2.81 
1.61 2.25 1.81 3.03 0.00 2.68 2.11 1.88 1.72 2.24 1.50 2.43 1.94 2.12 2.22 1.99 0.00 2.39 2.03 2.00 
2.06 2.61 1.25 2.64 1.94 1.75 2.47 2.86 0.00 2.18 2.11 2.38 1.72 2.40 1.50 2.43 1.61 2.12 2.56 2.65 
0.00 3.06 2.36 2.00 1.72 2.61 1.25 2.81 1.94 2.25 2.47 2.36 0.00 2.01 2.78 1.88 2.06 2.24 1.50 2.76 
1.94 2.12 2.22 2.99 0.00 3.06 2.36 2.00 1.72 2.28 1.25 2.31 1.61 1.75 1.81 1.53 0.00 3.51 2.78 2.38 
2.06 2.74 1.50 2.76 1.94 2.12 2.22 1.99 0.00 2.01 2.78 1.88 2.06 2.24 1.50 2.76 1.94 2.12 2.22 2.99 
0.00 3.51 2.78 2.38 2.06 2.74 1.50 2.76 1.94 2.12 2.22 1.99 0.00 2.01 2.78 1.88 2.06 2.24 1.50 2.76 
1.94 2.12 2.22 2.99 0.00 3.51 2.78 2.38 2.06 2.74 1.50 2.76 1.94 2.12 2.22 1.99 0.00 2.01 2.78 1.88 
2.06 2.24 1.50 2.76 1.94 2.12 2.22 2.99 0.00 3.51 2.78 2.38 2.06 2.74 1.50 2.76 1.94 2.12 2.22 1.99 
0.00 2.01 2.78 1.88 2.06 2.24 1.50 2.76 1.94 2.12 2.22 2.99 0.00 3.51 2.78 2.38 2.06 2.74 1.50 2.76 
1.94 2.12 2.22 1.99 0.00 2.06 2.36 2.00 1.72 2.61 1.25 2.31 1.94 1.75 2.47 2.86 0.00 2.68 2.11 1.88 
1.72 2.90 1.50 2.43 1.61 2.12 2.56 2.65 0.00 2.39 2.03 2.00 2.06 2.61 1.25 2.14 1.94 2.25 2.47 2.36 
0.00 2.18 2.11 2.38 1.72 2.74 1.50 2.43 1.94 2.13 2.22 2.99 0.00 3.06 2.36 2.00 1.72 2.28 1.25 2.31 
1.61 1.75 1.81 1.53 0.00 2.01 2.78 1.88 2.06 2.24 1.50 2.76 1.94 2.12 2.22 2.99 0.00 3.06 2.36 2.00 
1.72 2.61 1.25 2.81 1.94 2.25 2.47 2.36 0.00 3.51 2.78 2.38 2.06 2.74 1.50 2.76 1.94 2.12 2.22 1.99 
0.00 2.18 2.11 2.38 1.72 2.40 1.50 2.43 1.61 2.12 2.56 2.65 0.00 2.18 2.11 2.38 1.72 2.74 1.50 2.43 
1.94 2.13 2.22 2.99 0.00 3.51 2.78 2.38 2.06 2.74 1.50 2.76 1.94 2.12 2.22 1.99 0.00 2.18 2.11 2.38 
1.72 2.40 1.50 2.43 1.61 2.12 2.56 2.65 0.00 2.18 2.11 2.38 1.72 2.74 1.50 2.43 1.94 2.13 2.22 2.99 
0.00 3.51 2.78 2.38 2.06 2.74 1.50 2.76 1.94 2.12 2.22 1.99 0.00 2.18 2.11 2.38 1.72 2.40 1.50 2.43 
1.61 2.12 2.56 2.65 0.00 3.51 2.78 2.38 2.06 2.74 1.50 2.76 1.94 2.12 2.22 1.99 0.00 2.39 2.03 2.00 
2.06 2.61 1.25 2.14 1.94 2.25 2.47 2.36 0.00 2.01 2.78 1.88 2.06 2.24 1.50 2.76 1.94 2.12 2.22 2.99 
0.00 2.39 2.03 2.00 2.06 2.61 1.25 2.64 1.94 1.75 2.47 2.86 0.00 3.51 2.78 2.38 2.06 2.74 1.50 2.76 
1.94 2.12 2.22 1.99 0.00 2.39 2.03 2.00 2.06 2.61 1.25 2.14 1.94 2.25 2.47 2.36 0.00 2.01 2.78 1.88 
2.06 2.24 1.50 2.76 1.94 2.12 2.22 2.99 0.00 2.39 2.03 2.00 2.06 2.61 1.25 2.64 1.94 1.75 2.47 2.86
*/


